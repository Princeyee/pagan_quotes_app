# üîß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ Google Drive —Å–µ—Ä–≤–∏—Å–∞

## üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
2. **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - —É–±—Ä–∞–Ω `serverClientId` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ `google-services.json`
3. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –º–µ—Ç–æ–¥ `forceReauth()` –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å —Ç–æ–∫–µ–Ω–∞–º–∏
4. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞
5. **–õ—É—á—à–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —ç–º–æ–¥–∑–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å

### 1. –ó–∞–º–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

```dart
// –í–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
// import '../services/google_drive_service.dart';

// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–π
import '../services/google_drive_service_fixed.dart';

// –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
final driveService = GoogleDriveServiceFixed();
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

```dart
Future<void> initializeDriveService() async {
  print('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google Drive...');
  
  bool success = await driveService.initialize();
  
  if (!success) {
    print('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${driveService.getLastError()}');
    
    // –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    print('üîÑ –ü—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');
    success = await driveService.forceReauth();
    
    if (!success) {
      print('üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${driveService.getLastError()}');
      // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
      _showErrorDialog();
      return;
    }
  }
  
  print('‚úÖ Google Drive –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
  print('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${driveService.getCurrentUserEmail()}');
}
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

```dart
Future<List<drive.File>> loadAudiobooks() async {
  try {
    print('üìÅ –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞—É–¥–∏–æ–∫–Ω–∏–≥...');
    
    final files = await driveService.getAudiobookFiles();
    
    if (files.isEmpty) {
      print('üì≠ –§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
      
      // –ü–æ–ª—É—á–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
      final diagnostics = await driveService.getDiagnosticInfo();
      print('üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: $diagnostics');
      
      // –ü–æ–ø—Ä–æ–±—É–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–µ—à
      print('üîÑ –û–±–Ω–æ–≤–ª—è–µ–º –∫–µ—à...');
      final refreshedFiles = await driveService.refreshFiles();
      
      return refreshedFiles;
    }
    
    print('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${files.length} —Ñ–∞–π–ª–æ–≤');
    return files;
    
  } catch (e) {
    print('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤: $e');
    print('üîç –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–∏—Å–∞: ${driveService.getLastError()}');
    return [];
  }
}
```

### 4. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

```dart
Future<void> runDiagnostics() async {
  print('üîç –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...');
  
  final diagnostics = await driveService.getDiagnosticInfo();
  
  print('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:');
  print('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω: ${diagnostics['isInitialized']}');
  print('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${diagnostics['userEmail']}');
  print('–û–Ω–ª–∞–π–Ω: ${diagnostics['isOnline']}');
  print('–§–∞–π–ª–æ–≤ –≤ –∫–µ—à–µ: ${diagnostics['cachedFilesCount']}');
  print('–°—Ç–∞—Ç—É—Å –∫–µ—à–∞: ${diagnostics['cacheStatus']}');
  
  if (diagnostics['lastError'] != null && 
      diagnostics['lastError'].toString().isNotEmpty) {
    print('‚ùå –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞: ${diagnostics['lastError']}');
  }
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤ —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  await _saveDiagnosticsToFile(diagnostics);
}
```

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

–ù–∞–π–¥–∏—Ç–µ –≤ –≤–∞—à–µ–º –∫–æ–¥–µ –º–µ—Å—Ç–∞, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `GoogleDriveService`, –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ `GoogleDriveServiceFixed`:

```dart
// –í —Ñ–∞–π–ª–µ, –≥–¥–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, main.dart –∏–ª–∏ audiobook_service.dart)

class AudiobookService {
  // –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É
  // final GoogleDriveService _driveService = GoogleDriveService();
  
  // –ù–∞ —ç—Ç—É
  final GoogleDriveServiceFixed _driveService = GoogleDriveServiceFixed();
  
  // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
}
```

### 6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```dart
// –í main.dart –∏–ª–∏ –≤ –º–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
import 'debug/google_drive_test.dart';

// –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –∏–ª–∏ –ø—É–Ω–∫—Ç –º–µ–Ω—é –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
ElevatedButton(
  onPressed: () {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => const GoogleDriveTestPage(),
      ),
    );
  },
  child: const Text('üîß –¢–µ—Å—Ç Google Drive'),
)
```

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Cloud Console

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   ```bash
   # –ù–∞ Windows
   scripts\setup_google_apis.bat
   
   # –ù–∞ Linux/Mac
   bash scripts/setup_google_apis.sh
   ```

2. **–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ —Å–∫—Ä–∏–ø—Ç–µ** –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Google Cloud Console

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   - ‚úÖ Google Sign-In API –≤–∫–ª—é—á–µ–Ω
   - ‚úÖ Google Drive API –≤–∫–ª—é—á–µ–Ω
   - ‚úÖ OAuth 2.0 Client ID –Ω–∞—Å—Ç—Ä–æ–µ–Ω
   - ‚úÖ SHA-1 –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω
   - ‚úÖ Package name –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Google Drive**
3. **–ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç –≤—Ö–æ–¥–∞"** - –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ
4. **–ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç —Ñ–∞–π–ª–æ–≤"** - –¥–æ–ª–∂–Ω—ã –∑–∞ÔøΩÔøΩ—Ä—É–∑–∏—Ç—å—Å—è —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É** - –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –Ω–æ—Ä–º–µ

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ –≤—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Google Cloud Console
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SHA-1 –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ package name –≤ `google-services.json`
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

### –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–∞–ø–∫–µ —Å ID `1b7PFjESsnY6bsn9rDmdAe10AU0pQNwiM`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Google Drive API –≤–∫–ª—é—á–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à

### –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Google APIs

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ù–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ —Å—Ç–∞—Ä—ã–º API
- –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ
- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –æ—Ç–ª–∞–¥–∫–∏

---

**–£–¥–∞—á–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π! üöÄ**